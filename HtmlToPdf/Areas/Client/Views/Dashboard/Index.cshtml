@model HtmlToPdf.Areas.Client.Models.DashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}
<!-- START CONTAINER FLUID -->
<div class="container sm-padding-10 p-t-20 p-l-0 p-r-0">
    <!-- START ROW -->
    <div class="row">
        <div class="col-lg-6 col-sm-12 d-flex flex-column">
            <!-- START WIDGET widget_map_sales-->
            <!-- START ITEM -->
            <div class="card social-card share  full-width m-b-10 no-border" data-social="item">
                <div class="card-header ">
                    <h5 class="text-complete pull-left fs-12">
                        Account Details <i class="fa fa-circle text-complete fs-11"></i>
                    </h5>
                    <div class="clearfix"></div>
                </div>
                <div class="card-description" style="min-height:120px">
                    <h6>API KEY: <strong>@Model.ApiKey</strong></h6>
                    <h6>Subscription: <strong>@Model.SubscriptionName</strong></h6>
                    <h6>Included Requests: <strong>@Model.SubscriptionRequests</strong></h6>
                </div>

            </div>
            <!-- END ITEM -->
            <!-- END WIDGET -->
            <!-- START WIDGET widget_weekly_sales_card-->
            <div class="card no-border widget-loader-bar m-b-10">
                <div class="container-xs-height full-height">
                    <div class="row-xs-height">
                        <div class="col-xs-height col-top">
                            <div class="card-header  top-left top-right">
                                <div class="card-title">
                                    <span class="font-montserrat fs-11 all-caps">
                                        Total Requests <i class="fa fa-chevron-right"></i>
                                    </span>
                                </div>
                                <div class="card-controls">
                                    <ul>
                                        <li>
                                            <a href="#" class="portlet-refresh text-black" data-toggle="refresh"><i class="portlet-icon portlet-icon-refresh"></i></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-xs-height">
                        <div class="col-xs-height col-top">
                            <div class="p-l-20 p-t-50 p-b-40 p-r-20">
                                <h3 class="no-margin p-b-5">@Model.TotalRequests</h3>
                                <span class="small hint-text pull-left">@String.Format("{0}%", Model.TotalRequests / Model.SubscriptionRequests) of total plan</span>
                            </div>
                        </div>
                    </div>
                    <div class="row-xs-height">
                        <div class="col-xs-height col-bottom">
                            <div class="progress progress-small m-b-0">
                                <!-- START BOOTSTRAP PROGRESS (http://getbootstrap.com/components/#progress) -->
                                <div class="progress-bar progress-bar-primary" style='width:@String.Format("{0}%", Model.TotalRequests/Model.SubscriptionRequests)'></div>
                                <!-- END BOOTSTRAP PROGRESS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END WIDGET -->
            <!-- START WIDGET widget_weekly_sales_card-->
            <div class="card no-border widget-loader-bar m-b-10">
                <div class="container-xs-height full-height">
                    <div class="row-xs-height">
                        <div class="col-xs-height col-top">
                            <div class="card-header  top-left top-right">
                                <div class="card-title">
                                    <span class="font-montserrat fs-11 all-caps">
                                        Failed Requests <i class="fa fa-chevron-right"></i>
                                    </span>
                                </div>
                                <div class="card-controls">
                                    <ul>
                                        <li>
                                            <a href="#" class="portlet-refresh text-black" data-toggle="refresh"><i class="portlet-icon portlet-icon-refresh"></i></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-xs-height">
                        <div class="col-xs-height col-top">
                            <div class="p-l-20 p-t-50 p-b-40 p-r-20">
                                <h3 class="no-margin p-b-5">@Model.FailedRequests</h3>
                                <span class="small hint-text pull-left">@String.Format("{0}%", Model.FailedRequests / (Model.TotalRequests == 0 ? 1 : Model.TotalRequests)) of requests</span>
                            </div>
                        </div>
                    </div>
                    <div class="row-xs-height">
                        <div class="col-xs-height col-bottom">
                            <div class="progress progress-small m-b-0">
                                <!-- START BOOTSTRAP PROGRESS (http://getbootstrap.com/components/#progress) -->
                                <div class="progress-bar progress-bar-danger" style="width:@String.Format("{0}%", Model.FailedRequests / (Model.TotalRequests == 0 ? 1 : Model.TotalRequests))"></div>
                                <!-- END BOOTSTRAP PROGRESS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END WIDGET -->
        </div>
        <div class="col-lg-6 col-sm-12 d-flex flex-column">
            <!-- START ITEM -->
            <div class="card social-card share  full-width m-b-10 no-border" data-social="item">
                <div class="card-header clearfix">
                    <h5 class="text-success pull-left fs-12">
                        Render Overview <i class="fa fa-circle text-success fs-11"></i>
                    </h5>
                    <div class="clearfix"></div>
                </div>
                <div class="card-body">
                    <div class="d-flex flex-column full-height p-l-10" style="min-height:350px">
                        <div class="nvd3-line line-chart text-center flex-1" data-x-grid="false">
                            <svg class="full-height"></svg>
                        </div>
                    </div>
                </div>
                <div class="card-footer clearfix">
                    <div class="pull-left">
                        LAST UPDATE <span class="text-success">@DateTime.UtcNow.ToShortDateString() @DateTime.UtcNow.ToShortTimeString()</span>
                    </div>

                    <div class="clearfix"></div>
                </div>
            </div>
            <!-- END ITEM -->
        </div>
    </div>
    <!-- END ROW -->
</div>
<!-- END CONTAINER FLUID -->

@section Scripts{
    <link href="/admin/assets/plugins/nvd3/nv.d3.min.css" rel="stylesheet" type="text/css" media="screen" />
    <script src="/admin/assets/plugins/nvd3/lib/d3.v3.js" type="text/javascript"></script>
    <script src="/admin/assets/plugins/nvd3/nv.d3.min.js" type="text/javascript"></script>
    <script src="/admin/assets/plugins/nvd3/src/utils.js" type="text/javascript"></script>
    <script src="/admin/assets/plugins/nvd3/src/tooltip.js" type="text/javascript"></script>
    <script src="/admin/assets/plugins/nvd3/src/interactiveLayer.js" type="text/javascript"></script>
    <script src="/admin/assets/plugins/nvd3/src/models/axis.js" type="text/javascript"></script>
    <script src="/admin/assets/plugins/nvd3/src/models/line.js" type="text/javascript"></script>
    <script src="/admin/assets/plugins/nvd3/src/models/lineWithFocusChart.js" type="text/javascript"></script>


    <script>
        (function () {
            'use strict';


                        @{
                            var data = new List<List<int>>();
                            foreach(var day in Model.DailyRequests)
                            {
                                data.Add(new List<int>() { (int)((day.Key - new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc)).TotalSeconds), day.Value });
                            }
                        }

                        //NVD3 Charts
                        var data = {
                "nvd3": {
                            "line": [{ "key": "Api Requests", "values": @Html.Raw(Json.Serialize(data)) }],
                }
            }
            nv.addGraph(function () {
                var chart = nv.models.lineChart()
                    .x(function (d) {
                        return d[0]
                    })
                    .y(function (d) {
                return d[1]
                    })
                    .color([
                        $.Pages.getColor('success'),
                        $.Pages.getColor('danger'),
                        $.Pages.getColor('primary'),
                        $.Pages.getColor('complete'),

                    ])
                    .showLegend(false)
                    .margin({
                left: 30,
                        bottom: 35
                    })
                    .useInteractiveGuideline(true);

            chart.xAxis
                .tickFormat(function (d) {
                        return d3.time.format('%a')(new Date(d))
                    });

                chart.yAxis.tickFormat(d3.format('d'));

                d3.select('.nvd3-line svg')
                    .datum(data.nvd3.line)
                    .transition().duration(500)
                    .call(chart);

            nv.utils.windowResize(chart.update);

                $('.nvd3-line').data('chart', chart);

                return chart;
            });


        $(document).ready(function () {
            // Init portlets

            var bars = $('.widget-loader-bar');
            var circles = $('.widget-loader-circle');
            var circlesLg = $('.widget-loader-circle-lg');
            var circlesLgMaster = $('.widget-loader-circle-lg-master');



            bars.each(function () {
                var elem = $(this);
                elem.card({
                    progress: 'bar',
                    onRefresh: function () {
                        setTimeout(function () {
                            elem.card({
                                refresh: false
                            });
                        }.bind(this), 2000);
                    }
                });
            });


            circles.each(function () {
                var elem = $(this);
                elem.card({
                    progress: 'circle',
                    onRefresh: function () {
                        setTimeout(function () {
                            elem.card({
                                refresh: false
                            });
                        }.bind(this), 2000);
                    }
                });
            });

            circlesLg.each(function () {
                var elem = $(this);
                elem.card({
                    progress: 'circle-lg',
                    progressColor: 'white',
                    overlayColor: '0,0,0',
                    overlayOpacity: 0.6,
                    onRefresh: function () {
                        setTimeout(function () {
                            elem.card({
                                refresh: false
                            });
                        }.bind(this), 2000);
                    }
                });
            });


            circlesLgMaster.each(function () {
                var elem = $(this);
                elem.card({
                    progress: 'circle-lg',
                    progressColor: 'master',
                    overlayOpacity: 0.6,
                    onRefresh: function () {
                        setTimeout(function () {
                            elem.card({
                                refresh: false
                            });
                        }.bind(this), 2000);
                    }
                });
            });

        });

                }) ();
    </script>

}